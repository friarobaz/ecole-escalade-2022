{
  "version": 3,
  "sources": ["../hookar/index.js"],
  "sourcesContent": ["\r\n\r\n/**\r\n * @template H\r\n * @callback AddHookToCollection\r\n * @param {H} hook\r\n * @returns {function} unhook\r\n **/\r\n\r\n/**\r\n * @template H\r\n * @typedef {AddHookToCollection<H> & HooksCollectionProps<H>} HooksCollection\r\n */\r\n\r\n/**\r\n * @template H hook\r\n * @typedef {Object} HooksCollectionProps\r\n * @prop {H} run\r\n * @prop {H[]} hooks\r\n */\r\n\r\n/**\r\n * creates a hook collection\r\n * @template H\r\n * @return {HooksCollection<H>}\r\n * @example\r\n * const hooksCollection = createHook()\r\n * const unhookFn = hooksCollection(x => console.log('hello', x))\r\n * const unhookFn2 = hooksCollection(x => console.log('goodbye', x))\r\n *\r\n * // call hooks\r\n * hooksCollection.hooks.forEach(hook => hook('Jake'))\r\n * // logs \"hello Jake\" and \"goodbye Jake\"\r\n *\r\n * // unregister\r\n * unhookFn()\r\n * unhookFn2()\r\n */\r\nconst createHooksCollection = (runner) => {\r\n    /** @type {H[]} */\r\n    const hooks = []\r\n\r\n    /**\r\n     *@type {HooksCollection<H>}\r\n     */\r\n    const hooksCollection = hook => {\r\n        hooks.push(hook)\r\n        return () => hooks.splice(hooks.indexOf(hook), 1)\r\n    }\r\n\r\n    hooksCollection.hooks = hooks\r\n    hooksCollection.run = runner(hooks)\r\n\r\n    return hooksCollection\r\n}\r\n\r\n\r\n\r\n/**\r\n * @template P\r\n * @typedef {HooksCollection<(pri: P, ...rest)=>P>} CollectionSync\r\n */\r\n/**\r\n * @template P\r\n * @typedef {HooksCollection<(pri: P, ...rest)=>P|Promise<P>>} CollectionAsync\r\n */\r\n/**\r\n * @template P\r\n * @typedef {HooksCollection<((pri: P, ...rest)=>void)>} CollectionSyncVoid\r\n */\r\n/**\r\n * @template P\r\n * @typedef {HooksCollection<(pri: P, ...rest)=>void|Promise<void>>} CollectionAsyncVoid\r\n */\r\n\r\n\r\n/**\r\n * @template T\r\n * @param {T=} type\r\n * @returns {HooksCollection<T>}\r\n */\r\nexport const createPipelineCollection = (type) =>\r\n    // @ts-ignore\r\n    createHooksCollection(\r\n        hooks =>\r\n            (value, ...rest) =>\r\n                hooks.reduce(\r\n                    (pipedValue, hook) =>\r\n                        pipedValue?.then\r\n                            ? pipedValue.then(r => hook(r, ...rest))\r\n                            : hook(pipedValue, ...rest),\r\n                    value,\r\n                ),\r\n    )\r\n\r\n/**\r\n * @template T\r\n * @param {T=} type\r\n * @returns {CollectionSyncVoid<T>|CollectionAsyncVoid<T>}\r\n */\r\nexport const createSequenceHooksCollection = (type) =>\r\n    createHooksCollection(\r\n        hooks =>\r\n            (value, ...rest) => hooks.reduce(\r\n                (last, hook) =>\r\n                    last?.then ? last.then(_ => hook(value, ...rest)) : hook(value, ...rest),\r\n                value,\r\n            )\r\n    )\r\n\r\n/**\r\n * @template T\r\n * @param {T=} type\r\n * @returns {CollectionSyncVoid<T>|CollectionAsyncVoid<T>}\r\n */\r\nexport const createParallelHooksCollection = (type) =>\r\n    createHooksCollection(\r\n        hooks =>\r\n            (value, ...rest) =>\r\n                Promise.all(hooks.map(hook => hook(value, ...rest))).then(r => value),\r\n    )\r\n\r\n/**\r\n * @template T\r\n * @param {T=} type\r\n * @returns {CollectionSync<T>|CollectionAsync<T>}\r\n */\r\nexport const createGuardsCollection = (type) =>\r\n    // @ts-ignore\r\n    createHooksCollection(\r\n        hooks =>\r\n            (value, ...rest) =>\r\n                hooks.reduce(\r\n                    (pipedValue, hook) =>\r\n                        pipedValue?.then\r\n                            ? pipedValue.then(r => r && hook(value, ...rest))\r\n                            : pipedValue && hook(value, ...rest),\r\n                    value || true,\r\n                ),\r\n    )\r\n"],
  "mappings": ";;;AAsCA,IAAM,wBAAwB,CAAC,WAAW;AAEtC,QAAM,QAAQ,CAAC;AAKf,QAAM,kBAAkB,UAAQ;AAC5B,UAAM,KAAK,IAAI;AACf,WAAO,MAAM,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,CAAC;AAAA,EACpD;AAEA,kBAAgB,QAAQ;AACxB,kBAAgB,MAAM,OAAO,KAAK;AAElC,SAAO;AACX;AA2BO,IAAM,2BAA2B,CAAC,SAErC,sBACI,WACI,CAAC,UAAU,SACP,MAAM,OACF,CAAC,YAAY,SACT,0CAAY,QACN,WAAW,KAAK,OAAK,KAAK,GAAG,GAAG,IAAI,CAAC,IACrC,KAAK,YAAY,GAAG,IAAI,GAClC,KACJ,CACZ;AAOG,IAAM,gCAAgC,CAAC,SAC1C,sBACI,WACI,CAAC,UAAU,SAAS,MAAM,OACtB,CAAC,MAAM,SACH,8BAAM,QAAO,KAAK,KAAK,OAAK,KAAK,OAAO,GAAG,IAAI,CAAC,IAAI,KAAK,OAAO,GAAG,IAAI,GAC3E,KACJ,CACR;AAOG,IAAM,gCAAgC,CAAC,SAC1C,sBACI,WACI,CAAC,UAAU,SACP,QAAQ,IAAI,MAAM,IAAI,UAAQ,KAAK,OAAO,GAAG,IAAI,CAAC,CAAC,EAAE,KAAK,OAAK,KAAK,CAChF;AAOG,IAAM,yBAAyB,CAAC,SAEnC,sBACI,WACI,CAAC,UAAU,SACP,MAAM,OACF,CAAC,YAAY,SACT,0CAAY,QACN,WAAW,KAAK,OAAK,KAAK,KAAK,OAAO,GAAG,IAAI,CAAC,IAC9C,cAAc,KAAK,OAAO,GAAG,IAAI,GAC3C,SAAS,IACb,CACZ;",
  "names": []
}
